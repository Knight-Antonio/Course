# 算式谜

>作者：赵文亮
>
>学号：2016011452
>
>邮箱：zhaowl16@mails.tsinghua.edu.cn
>
>在线文档：http://ca.johnwilliams.online
>
>下载地址：http://ca.johnwilliams.online/download/index.html



## 程序界面

主界面如下：

<img src='photos/ui.png' width='80%' >



## 操作指南

1. 点击标签页切换算式类型（加、减、乘、除）。
2. 在菜单栏可以选择状态转移方式和搜索算法。
3. 在`问题模式`下可以修改算式：

   - 增加操作数：点击工具栏中`增加操作数`按钮，即可在修改框中填写操作数，填写完毕后按下回车。
   - 修改操作数：左键双击任意一个字符，在工具栏中的修改框中会显示该字符所在操作数，修改完毕后按下回车。
   - 删除操作数：右键双击该操作数的任意一个字符，或修改操作数时将其置为空。


3. 点击`开始求解`按钮启动求解过程。如果算式无解或输入不正确，会显示响应的信息提示框。如果算式有解，则切换到`解答模式`并显示求解结果，在菜单栏显示求解时间。

4. `问题模式`下`查看问题`按钮被禁用，`解答模式`下`开始求解`按钮以及和修改操作数相关的功能被禁用。

5. 点击工具栏中`帮助`菜单，随时查看操作指南或在线文档。

6. 若输入字符为数字，则认为该位置的值为该数字。

7. 每个算式中不同字母代表的数字不同、至多有10个不同字母（对应0~9）。

## 算法简介

本程序内部使用了多种求解算法，按照后继状态的产生方式可以分为`附加法`和`交换法`，按照搜索的方式可以分为`宽度优先`、`深度优先`、`贪婪最佳优先`算法。

### 附加法

设输入算式中含有$n$个未知字符，分别记作$X_1, X_2, \ldots, X_{n}$。由问题本身特点，这$n$个未知字符各不相同，故共有$A_{10}^n$种可能的情况。`附加法`基本原理是从一个空序列出发，每次附加一个新数字，最终得到长度为$n$的数字序列，记作$D_1,D_2,\ldots, D_{n}$，其中$D_i\in\{0, 1, \ldots,9 \}$。再将这个序列代入到原来的算式进行判断即可得出结论。

#### 深度优先搜索

由于总的状态数目有限，可以通过深度优先搜索方法遍历每一种可能，对每一种情况判断是否满足算式。深度优先搜索设定初始解序列为空，通过递归的方式，每次选取一个没有被使用过的数字添加到解序列中，从新的解序列开始再次递归。不难证明，第$i$层的分支因子为$11-i$（初始状态为第一层），则总的叶节点数目不超过$10!$个。也就是说，这种搜索算法可以在常数时间内完成。

#### 贪婪优先搜索

深度优先搜索实际上是一种暴力的做法，将所有情况遍历，其中可能会访问一些无用的节点。贪婪优先搜索则在每次扩展节点后，优先访问那些代价较低的节点。此处设定的代价函数计算法方式如下：

1. 将当前的解序列$S_l=\{D_1, D_2,\ldots,D_{l}\}$补零，得到$\hat{S}_l=\{D_1, D_2,\ldots,D_{l},Z_{l+1},\ldots,Z_n\}$，其中$l$为当前的层数，$Z_i\equiv 0,\forall i$。
2. 将$\hat{S}_l$代入到原算式中，得到运算结果与实际结果的差值的绝对值，将这个值记作启发函数$h_1$

上述方法得到的$h_1$值具有一定的启发性。一方面，当$S_l$为原问题的一个解时，必有$h_1(\hat{S}_l)=0$；另一方面，$h_1$可以在一定程度上刻画当前$S_l$与实际解的接近程度。

### 交换法

将输入字符序列$\{ X_1, X_2, \ldots, X_{n}\}$使用空字符将其补齐为10个，得到${\bf T}_0=\{ X_1, X_2, \ldots, X_{n},N_{n+1},\ldots,N_{10}\}$,其中$N_i=null, \forall i$。上面的表达式意味着$\bf{T}$中每个字符分别与$0\sim 9$一一对应。将上述序列作为初始状态，每次任意交换其中两个元素得到下一状态，不难证明，至多经过$n$次交换就可以得到结果。该算法的分支因子至多为$C_{10}^2=45$，在某些情况下搜索时间较长。

#### 宽度优先、深度优先、贪婪最佳优先

在交换法中定义的状态以及后继状态产生方式的基础上，即可实现宽度优先、深度优先、贪婪最佳优先。

需要指出的是，由于该算法分支因子较多，即便使用Close表保存已经访问过的节点，时间和空间开销都较大，导致运行时间较长。在原算式无解的情况下，基于交换法的求解算法很难停止计算。为此，在交换法求解中，我设置了最大求解步数为1000000步，超过之后认为超时，不再求解。同时使用多线程技术采用贪婪最佳优先的附加法同时计算，从而判断无解情况以及在交换法超时后仍然能够给出解答。

